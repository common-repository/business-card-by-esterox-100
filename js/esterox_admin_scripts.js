jQuery(document).ready(function($){		$("#esterox_visita_id").change(function(){ 			$("#esterox_visita_bg_add").click();       		});		$("#esterox_visita_id").click(function(){ 			if($('#category').val()=='all'){				alert('Select category');				return false;			}					});		setTimeout(function(){				$('.save_canvas').click();		}, 1000);		$('.remove_text').click(function(){			//console.log(canvas1._objects);			var text_key = $(this).attr('key');			$(this).parent().remove();			for(var i in canvas1._objects){				var key = canvas1._objects[i].key;				if(key == text_key){					canvas1.remove(canvas1._objects[i]);					//canvas2.remove(canvas2._objects[i]);				}			}			canvas1.renderAll();			//console.log(canvas1._objects);					});						$('#edit').click(function(){						$('.save_canvas').click();						var current1_json = localStorage.getItem(item_id_ + '_curent1');			current1_json=JSON.parse(current1_json);			var current1_json1=JSON.stringify(current1_json.objects);						$('.img_data').val(current1_json1);								console.log(current1_json.objects);			//alert(current1_json.objects);			return true;		});				$('#check_all').click(function(){						if($(this).prop("checked")){				$("input:checkbox").each(function(indx, element){				  					$(element).prop('checked', true);				    $(".block img").addClass("cheked");				});			}else{				$("input:checkbox").each(function(indx, element){				  				  $(element).prop('checked', false).removeClass("intro") ;                  $(".block img").removeClass("cheked");				});			}		});									$('.block input').click(function(){					if($(this).prop('checked')){							$(this).prev().prev().children().addClass("cheked");							} else {				$(this).prev().prev().children().removeClass("cheked");				}					});									$(".block input:checkbox").each(function(indx, element){				  			if($(element).prop('checked')){				$(element).prev().prev().children().addClass("cheked");			}else{				$(element).prev().prev().children().removeClass("cheked");			}					});						$('.remove_fon').click(function(){			var fon_key = $(this).attr('key');			$('#remove_key').val(fon_key);						$('.remove_fon_form').submit();					});				$('#category').change(function(){							var category_key = $(this).val();			var href = $(".change_category").attr('href');			location.href=href+category_key;		});				$('#new_cat').click(function(){						$(this).hide();						$('#add').show();					});				$('.edit').click(function(){						var key=$(this).attr('key');			var old_val =$('#old_cat_'+key).text();			$('#new_cat_'+key).val(old_val);			$('#new_cat_'+key).show().focus();			$('#old_cat_'+key).hide();					});				$('.edit_cat').blur(function(){				var key=$(this).attr('key');			$(this).after('<input type="hidden" name="edit_category" value="'+key+'">');			$('#edit').submit();			});				$('.dis_an').each(function(){			var status=$(this).attr('status');			if(status==1){				$(this).val('Disable');			}else{				$(this).val('Enable');			}		});				$('.dis_an').click(function(){				var key=$(this).attr('key');			if($(this).val()=='Disable'){				var status=0;			}else{				var status=1;			}			$(this).after('<input type="hidden" name="dis_an_id" value="'+key+'"><input type="hidden" name="dis_an_status" value="'+status+'">');			$('#edit').submit();			});						$('.del_cat').click(function(){				var key=$(this).attr('key');						$(this).after('<input type="hidden" name="del_category" value="'+key+'">');			$('#edit').submit();			});						 if(typeof item_id_ !== "undefined"){			obj = cards[item_id_];			console.log(obj);			for(var i=2; i<Object.keys(obj).length;i++){ 						//console.log(Object.keys(obj).length);				var j=i-1;				var currentText = 'text'+j;								$('.'+currentText).text(obj[currentText].name);				//$('.'+currentText).attr('placeholder',obj[currentText].name);							}			var k=6-Object.keys(obj).length+2;			//console.log(k);							for(var i=0;i<k;i++){				var j=Object.keys(obj).length-1+i;				var currentText = 'text'+j;				$('.'+currentText).parent().remove();			}		}			    $(".see_more a").click(function(){				var valu = $(".see_more").parent().children(".panel_head").children().val();				$("#category").val(valu).change();							});	});if(typeof item_id_ !== "undefined"){(function($){		$('.save_canvas').bind("click", function(){			if($('.canvas1_container').is(':visible')){				var tmp = '_1';			}else{				var tmp = '_2';			}			if($('.canvas1_container').is(':visible')){				$('.image' + tmp).attr('src', canvas1.toDataURL());				$('.image' + tmp).show();				localStorage.setItem(item_id_ + tmp, canvas1.toDataURL());				window.current_state1 = JSON.stringify(canvas1);				localStorage.setItem(item_id_ + '_curent1', window.current_state1);			}else{				$('.image' + tmp).attr('src', canvas2.toDataURL());				$('.image' + tmp).show();				$('.image' + tmp).parent().show();				localStorage.setItem(item_id_ + tmp, canvas2.toDataURL());				window.current_state2 = JSON.stringify(canvas2);				localStorage.setItem(item_id_ + '_curent2', window.current_state2);			}			localStorage.setItem(item_id_ + tmp + '_text1', $('.text1').val());			localStorage.setItem(item_id_ + tmp + '_text2', $('.text2').val());			localStorage.setItem(item_id_ + tmp + '_text3', $('.text3').val());			localStorage.setItem(item_id_ + tmp + '_text4', $('.text4').val());			localStorage.setItem(item_id_ + tmp + '_text5', $('.text5').val());			localStorage.setItem(item_id_ + tmp + '_text6', $('.text6').val());		});	function tmp(tmp){		if(localStorage.getItem(item_id_ + tmp) != null){			//$('.text1').val(localStorage.getItem(item_id_ + tmp + '_text1'));			//$('.text2').val(localStorage.getItem(item_id_ + tmp + '_text2'));			//$('.text3').val(localStorage.getItem(item_id_ + tmp + '_text3'));			//$('.text4').val(localStorage.getItem(item_id_ + tmp + '_text4'));			//$('.text5').val(localStorage.getItem(item_id_ + tmp + '_text5'));			//$('.text6').val(localStorage.getItem(item_id_ + tmp + '_text6'));			$('.image' + tmp).attr('src', localStorage.getItem(item_id_ + tmp));			$('.image' + tmp).show();			$('.image' + tmp).parent().show();			if(tmp == '_2'){				var id = localStorage.getItem(item_id_ + '_reverse_id');				//console.log(id);				id=3;				var obj = cards[id];				$('.add_edit_img').attr('src', base_url + obj.big_img);			}		}			}	function build_canvas_obj1(item_id){		var canvas_id = 'myCanvas';		obj = cards[item_id];		$('.canvas1_container').show();		$('.canvas2_container').hide();	    canvas1 = new fabric.Canvas('myCanvas');					    				for(var i=2; i<Object.keys(obj).length;i++){ 						//console.log(Object.keys(obj).length);				var j=i-1;				var currentText = 'text'+j;						currentText = new fabric.Text(obj[currentText].name, {					top        : obj[currentText].top,					left       : obj[currentText].left,					fontSize   : obj[currentText].fontSize,					fontFamily : obj[currentText].fontFamily,					fontWeight : obj[currentText].fontWeight,					fill       : obj[currentText].fill,								textAlign  : obj[currentText].textAlign,					fontStyle  : obj[currentText].fontStyle,					scaleX     : obj[currentText].scaleX,					scaleY     : obj[currentText].scaleY,					angle     : obj[currentText].angle,					width      : obj[currentText].width,					height     : obj[currentText].height				});				currentText.hasControls = true;				//canvas1.moveto(currentText, 10);				currentText.key = "text"+j;				canvas1.add(currentText);		}		fabric.Image.fromURL(base_url + obj.big_img, function(img) {			canvas1.setBackgroundImage(base_url + obj.big_img, canvas1.renderAll.bind(canvas1), {			   				scaleY: canvas1.height/img.height,				scaleX: canvas1.width/img.width,		   });		});										canvas1.renderAll();		canvas1.on('object:moving',function(e){			if(e.target.type == "image"){				var activeObject = e.target;				//console.log(activeObject.get('left'), activeObject.get('top'));				jQuery(".delete_canvas_img").remove(); 				var btnLeft = activeObject.get('left');//e.target.oCoords.mt.x;				var btnTop = activeObject.get('top') -35;//e.target.oCoords.mt.y - 25;				var widthadjust=e.target.width/2;				btnLeft=widthadjust+btnLeft+55;				var delete_canvas_img = '<p" class="delete_canvas_img" style="color:white;position:absolute;top:'+btnTop+'px;left:'+btnLeft+'px;cursor:pointer;" title="Удалить"></p>';				jQuery(".canvas1_container .canvas-container").append(delete_canvas_img);			}		});		canvas1.on('selection:cleared',function(e){			jQuery(".delete_canvas_img").remove(); 		});		canvas1.on('object:selected',function(e){			if(e.target.type == "image"){				jQuery(".delete_canvas_img").remove(); 				var btnLeft = e.target.oCoords.mt.x;				var btnTop = e.target.oCoords.mt.y - 25;				var widthadjust=e.target.width/2;				btnLeft=widthadjust+btnLeft+7;				var delete_canvas_img = '<p" class="delete_canvas_img" style="color:white;position:absolute;top:'+btnTop+'px;left:'+btnLeft+'px;cursor:pointer;" title="Удалить"></p>';				jQuery(".canvas1_container .canvas-container").append(delete_canvas_img);			}					});		canvas1.on('mouse:down', function(options) { 			if(options.target){				// for(var i in canvas1._objects){					// var index = parseInt(i) + 1;					// canvas1._objects[i].key = "text" + index;				// }				current_obj1 = options.target;				var fontFamily = current_obj1.fontFamily;				$('.fonts').val(fontFamily);				var font_size = current_obj1.fontSize;				$('.font_size').val(font_size);				var color = current_obj1.fill;				$('.select_color_input').val(color);				key = current_obj1.key;				console.log(current_obj1);				setTimeout(function(){					$('.' + key).focus();				}, 0);			}		});		var tmp = '_1';		$('.custom_editor .text_align_left').click(function(){			if(typeof current_obj1 != "undefined"){				current_obj1.textAlign = 'left';				canvas1.renderAll();			}		});		$('.custom_editor .text_align_right').click(function(){			if(typeof current_obj1 != "undefined"){				current_obj1.textAlign = 'right';				canvas1.renderAll();			}		});		$('.custom_editor .text_align_center').click(function(){			if(typeof current_obj1 != "undefined"){				current_obj1.textAlign = 'center';				canvas1.renderAll();			}		});		$('.custom_editor .bold_block').click(function(){			if(typeof current_obj1 != "undefined"){				if(current_obj1.fontWeight == 'bold'){					current_obj1.fontWeight = 'normal';				}else{					current_obj1.fontWeight = 'bold';				}				canvas1.renderAll();							}					});		$('.custom_editor .italic_block').click(function(){			if(typeof current_obj1 != "undefined"){				if(current_obj1.fontStyle == 'italic'){					current_obj1.fontStyle = 'normal';				}else{					current_obj1.fontStyle = 'italic';				}				canvas1.renderAll();							}		});		$( ".h30" ).click(function() {			var text_key = $(this).next().attr('key');			var ob=canvas1.getObjects();			for(var i in ob){				var key = ob[i].key;				if(key == text_key){					canvas1.setActiveObject(ob[i]);				}			}		});		$( ".h30" ).keyup(function() {			var current_text = $(this).val();				var text_key = $(this).next().attr('key');			var ob=canvas1.getObjects();						for(var i in ob){				var key = ob[i].key;				if(key == text_key){					ob[i].text = current_text;									}			}				canvas1.renderAll();		});							$('.fonts').change(function(){			var font = $(this).val();			//text1.set({ fontFamily: font });			if(typeof current_obj1 != "undefined"){				current_obj1.fontFamily = font;				canvas1.renderAll();						}		});		$('.font_size').change(function(){			var font_size = $(this).val();			//text1.set({ fontFamily: font });			if(typeof current_obj1 != "undefined"){				current_obj1.fontSize = font_size;				canvas1.renderAll();			}		});		$('.select_color_input').change(function(){			var color = $(this).val();			if(typeof current_obj1 != "undefined"){				current_obj1.fill = color;				canvas1.renderAll();			}		});		$(document).on('click', '.delete_canvas_img', function(){			canvas1.remove(canvas1.getActiveObject());			if(typeof canvas2 != "undefined"){				canvas2.remove(canvas2.getActiveObject());			}			$(this).remove();		});			}		function events2(){		$('.custom_editor .bold_block').click(function(){			if(typeof current_obj2 != "undefined"){				if(current_obj2.fontWeight == 'bold'){					current_obj2.fontWeight = 'normal';					canvas2.renderAll();				}else{					current_obj2.fontWeight = 'bold';					canvas2.renderAll();				}			}		});		$(document).on('click', '.custom_editor .italic_block', function(){			if(typeof current_obj2 != "undefined"){				if(current_obj2.fontStyle == 'italic'){					current_obj2.fontStyle = 'normal';					canvas2.renderAll();				}else{					current_obj2.fontStyle = 'italic';					canvas2.renderAll();				}			}		});	}	build_canvas_obj1(item_id_);		tmp('_1');})(jQuery);}